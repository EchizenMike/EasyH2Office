{extend name="../../base/view/common/base" /}
{block name="body"}
<form class="layui-form p-4">
    <h3 class="pb-3">登录LOGO配置</h3>
    <table class="layui-table layui-table-form">
        <tr>
            <td class="layui-td-gray" style="width: 150px;">登录页 LOGO</td>
            <td>
                <div class="layui-upload" style="width: 240px;">
                    <div class="layui-upload-list" id="loginlogo" style="width: 100%; height:64px; overflow: hidden;">
                        <img src="{$config.loginlogo|default='/static/home/images/loginlogo.png'}" style="max-width: 100%; height: 64px;" />
                        <input type="hidden" name="loginlogo" value="{$config.loginlogo|default='/static/home/images/loginlogo.png'}">
                    </div>
                    <button type="button" class="layui-btn" style="width: 100%;" id="uploadLoginLogoBtn">上传 LOGO</button>
                </div>
            </td>
        </tr>
    </table>

    <div class="pt-3">
        <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="webform">立即提交</button>
        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
</form>
{/block}

{block name="script"}
<script>
    const moduleInit = ['tool'];
    function gouguInit() {
        var form = layui.form, tool = layui.tool, upload = layui.upload;

        // 提交表单
        form.on('submit(webform)', function (data) {
            let callback = function (e) {
                layer.msg(e.msg);
                if (e.code == 0) {
                    setTimeout(function(){
                        parent.parent.location.reload();
                    }, 1000);
                }
            };
            data.field.id = 6;
            tool.post("/home/conf/edit", data.field, callback);
            return false;
        });

        // 登录LOGO上传
        upload.render({
            elem: '#uploadLoginLogoBtn',
            url: "/api/index/upload",
            done: function (res) {
                layer.msg(res.msg);
                if (res.code == 0) {
                    $('#loginlogo input').val(res.data.filepath);
                    $('#loginlogo img').attr('src', res.data.filepath);
                }
            }
        });
    }
</script>
{/block}
