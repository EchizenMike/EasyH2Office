{extend name="common/base"/}
{block name="style"}
<link rel="stylesheet" href="{__LAYUI__}/font/extend/iconfont.css?v={:get_system_config('web','version')}">
<link rel="stylesheet" href="{__CSS__}/gougucms.css?v={:get_system_config('web','version')}">
{/block}
<!-- 主体 -->
{block name="body"}

<div class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div class="layui-header">
			<div class="layui-logo" ittab-home><img src="{__IMG__}/syslogo.png" width="166" alt="{:get_system_config('web','admin_title')}" /></div>
			<ul class="layui-nav layui-layout-right">
				<li class="layui-nav-item" lay-unselect>
					<a href="javascript:;" ittab-refresh class="refreshThis" id="ittab-refresh" title="刷新当前页"
						style="margin-top:3px;">
						<i class="layui-icon layui-icon-refresh-3"></i>
					</a>
				</li>
				<li class="layui-nav-item" lay-unselect>
					<a href="javascript:;" ittab-del-cache id="ittab-del-cache" style="margin-top:2px;" title="清空缓存"><i
							class="layui-icon layui-icon-fonts-clear"></i></a>
				</li>
				<li class="layui-nav-item" lay-unselect>
					<a href="javascript:;" ittab-logout title="{:get_login_admin('nickname')}-点击退出登录">
						<img src="{:get_login_admin('thumb')}" class="layui-nav-img" onerror="javascript:this.src='{__IMG__}/nonepic360x360.jpg';this.onerror=null;">
					</a>
					<div id="msgNum" class="msg-num"><a data-id="27" data-title="已收消息" data-src="/home/mail/inbox.html" class="site-menu-active" title="未读消息">0</a></div>
				</li>
			</ul>
		</div>

		<div class="layui-side ittab-bg-gray">
			<div class="ittab-menulist">
				<div class="ittab-menulist-top">
					<a href="/" title="返回首页" style="background-color: #E94335"><i class="layui-icon layui-icon-home"></i></a><a href="javascript:;" title="修改个人信息" style="background-color:#fbbc05" data-id="10000" data-title="修改个人信息" data-src="/home/api/edit_personal" class="site-menu-active"><i class="layui-icon layui-icon-username"></i></a><a href="javascript:;" title="修改密码" style="background-color:#4285f4" data-id="10001" data-title="修改密码" data-src="/home/api/edit_password" class="site-menu-active"><i class="layui-icon layui-icon-password"></i></a>
				</div>
				<div class="ittab-menulist-1">
					{foreach name="menu" item="a"}
					<div class="ittab-menulist-2"><i class="iconfont {$a.icon}"></i> {$a.title}</div>
					{notempty name="$a.list"}
					<div class="ittab-menulist-3">
						<ul>
							{foreach name="$a.list" item="b"}
							{empty name="$b.list"}
							<li data-id="{$b.id}" data-title="{$b.title}" data-src="{:url($b.src)}"
								class="site-menu-active"><span>{$b.title}</span></li>
							{else /}
							<li class="ittab-menulist-2">{$b.title}<i class="layui-icon layui-icon-triangle-r"></i></li>
							<div class="ittab-menulist-3 ittab-menulist-4">
								<ul>
									{foreach name="$b.list" item="c"}
									{empty name="$c.list"}
									<li data-id="{$c.id}" data-title="{$c.title}" data-src="{:url($c.src)}"
										class="site-menu-active"><span>{$c.title}</span></li>
									{else /}
									<li class="ittab-menulist-2">{$c.title}<i
											class="layui-icon layui-icon-triangle-r"></i></li>
									<div class="ittab-menulist-3 ittab-menulist-5">
										<ul>
											{foreach name="$c.list" item="d"}
											<li data-id="{$d.id}" data-title="{$d.title}" data-src="{:url($d.src)}"
												class="site-menu-active"><span>{$d.title}</span></li>
											{/foreach}
										</ul>
									</div>
									{/empty}
									{/foreach}
								</ul>
							</div>
							{/empty}
							{/foreach}
						</ul>
					</div>
					{/notempty}
					{/foreach}
				</div>
			</div>
		</div>

		<div class="layui-body">
			<div class="layui-tab layui-tab-brief gougu-admin-tab" lay-filter="gougu-admin-tab" lay-unauto="" lay-allowClose="true" style="height: 100%;">
				<ul class="layui-tab-title">
					<li class="layui-this ittab-tab-home" lay-id="0">首页</li>
				</ul>
				<div class="layui-icon layui-icon-prev" id="left_button" title="向左滚动菜单"></div>
				<div class="layui-icon layui-icon-next" id="right_button" title="向右滚动菜单"></div>
				<div class="layui-tab-content" style="height: 100%;">
					<div class="layui-tab-item layui-show">
						<iframe id="0" data-frameid="0" name="myiframe" src="/home/index/main" frameborder="0" align="left" width="100%" height="100%" scrolling="yes"></iframe>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- /主体 -->
{/block}
<!-- 脚本 -->
{block name="script"}
<script>
	var msgStatus=0,isClose=0,msgNum = 0;
	function init(layui) {
		var layer = layui.layer;
		$("[ittab-logout]").on("click", function () {
			layer.confirm('确认注销登录吗?', { icon: 7, title: '警告' }, function (index) {
				//注销
				$.ajax({
					url: "/home/login/login_out",
					success: function (e) {
						layer.msg(e.msg);
						if (e.code == 0) {
							setTimeout(function () {
								location.href = "/home/login/index"
							}, 1000)
						}
					}
				})
				layer.close(index);
			});
		});
	};
	//轮循获取消息
	var getStatus = setInterval(function () {
		$.ajax({
			url: "/home/index/index",
			type:'post',
			success:function(e){
				if(e.code==0 && e.data!=''){
					if(e.data.num_mail>0){
						$('#msgNum').show().find('a').html(e.data.num_mail);
					}
					else{
						$('#msgNum').hide().find('a').html(0);
					}
					if(isClose==0){
						var html = '<ul id="messageul" style="line-height:24px;">';						
						$.each(e.data, function(key, value) {
							if(key!='num_mail'){
								html += '<li style="cursor:pointer;">'+value+'</li>';
							}							
						});
						html +='</ul>'; 
						if(msgStatus==1){
							$('#msgBox').html(html);
						}else{
							layer.open({
								type: 1
								,title:'消息提醒'
								,offset: 'rb'
								,area:['240px','168px']
								,content: '<div id="msgBox" style="padding:10px 15px;">'+html+'</div>'
								,btnAlign: 'c' //按钮居中
								,shade: 0 //不显示遮罩
								,success:function(){
									msgStatus=1;
								}
								,cancel:function(){
									msgStatus=0;
									isClose=1;
								}
							});
						}
					}
				}else{
					msgStatus=0;
					layer.closeAll();
				}
			}
		})
	}, 10000);
</script>
{include file="common/layui" base='base' extend="['gougucms']" callback="init" /}
{/block}
<!-- /脚本 -->